<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•†å“è¯¦æƒ… - è¿è¥æ§åˆ¶å°</title>
    <meta name="format-detection" content="telephone=no">
    <style>
        :root {
            --primary: #4ECDC4;
            --primary-light: #e8f8f7;
            --primary-dark: #3dbdb4;
            --danger: #ff6b6b;
            --warning: #ffa502;
            --success: #2ed573;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --text-muted: #b2bec3;
            --bg-body: #f8f9fa;
            --bg-card: #ffffff;
            --border: #e9ecef;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.04);
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius: 12px;
            --radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-body);
            min-height: 100vh;
            font-size: 14px;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #fff 0%, #fafafa 100%);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 100;
            box-shadow: 4px 0 20px rgba(0,0,0,0.04);
        }

        .sidebar-header {
            padding: 28px 24px;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.3);
        }

        .brand-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .brand-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.3px;
        }

        .brand-version {
            font-size: 12px;
            color: var(--text-muted);
            padding-left: 52px;
        }

        .sidebar-nav {
            flex: 1;
            padding: 8px 12px;
            min-height: 0;
            overflow-y: auto;
        }

        .nav-section {
            margin-bottom: 8px;
        }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 8px 14px;
            margin-bottom: 4px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 11px 14px;
            margin-bottom: 2px;
            color: var(--text-secondary);
            transition: all 0.15s;
            font-size: 14px;
            border-radius: var(--radius);
            font-weight: 500;
            text-decoration: none;
        }

        .nav-item:hover {
            background: var(--bg-body);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .main {
            flex: 1;
            margin-left: 240px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left {
            display: flex;
            flex-direction: column;
        }

        .header-subtitle {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 2px;
        }

        .header-title {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            font-weight: 500;
        }

        .btn-default {
            background: #fff;
            border-color: var(--border);
            color: var(--text-secondary);
        }

        .btn-default:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .content {
            flex: 1;
            padding: 28px 32px;
            overflow-y: auto;
        }

        .form-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-label .required {
            color: var(--danger);
            margin-left: 2px;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 14px;
            color: var(--text-primary);
            background: #fff;
            outline: none;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .lang-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: var(--radius-sm);
            margin-bottom: 16px;
        }

        .lang-section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .lang-section-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .lang-section-badge {
            padding: 4px 10px;
            background: var(--primary);
            color: #fff;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .option-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        .option-title {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 16px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .option-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
        }

        .option-toolbar-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .option-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .option-item {
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            background: #f5f5f5;
            color: var(--text-secondary);
        }

        .option-item:hover {
            background: var(--primary-light);
        }

        .option-item.selected {
            background: var(--primary);
            color: #fff;
            font-weight: 500;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-online {
            background: #e8f5e9;
            color: var(--success);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
        }

        .switch-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .switch {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 26px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        .switch-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .toast {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: #333;
            color: white;
            padding: 14px 32px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 500;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .tag-drawer-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            z-index: 1200;
            align-items: stretch;
            justify-content: flex-end;
        }

        .tag-drawer-overlay.active {
            display: flex;
        }

        .tag-drawer {
            background: #fff;
            width: min(980px, 92vw);
            box-shadow: var(--shadow);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: row;
        }

        .tag-drawer-side {
            width: 260px;
            border-right: 1px solid var(--border);
            background: #fafcfd;
            display: flex;
            flex-direction: column;
        }

        .tag-drawer-side-header {
            padding: 18px 16px 10px;
            border-bottom: 1px solid var(--border);
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tag-tree {
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .tag-tree-item {
            text-align: left;
            border: 1px solid transparent;
            background: transparent;
            border-radius: 10px;
            padding: 10px 12px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .tag-tree-item:hover {
            background: #f2f7f8;
            color: var(--text-primary);
        }

        .tag-tree-item.active {
            background: var(--primary-light);
            border-color: #bde9e6;
            color: var(--primary-dark);
            font-weight: 600;
        }

        .tag-drawer-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .tag-drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        .tag-drawer-title {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .tag-drawer-body {
            padding: 14px 20px 18px;
            overflow-y: auto;
            flex: 1;
        }

        .existing-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 14px;
            padding-bottom: 12px;
            border-bottom: 1px dashed var(--border);
        }

        .existing-tag-item {
            border: 1px solid var(--border);
            background: #fff;
            color: var(--text-secondary);
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            max-width: 240px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .existing-tag-item:hover {
            border-color: var(--primary);
            color: var(--primary-dark);
            background: var(--primary-light);
        }

        .existing-tag-item.active {
            border-color: var(--primary);
            background: var(--primary);
            color: #fff;
            font-weight: 600;
        }

        .existing-tag-helper {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .tag-drawer-footer {
            padding: 14px 20px 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            border-top: 1px solid var(--border);
        }

        .tag-default-wrap {
            margin-top: 14px;
        }

        .tag-default-check {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }

        .tag-default-check input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .tag-default-box {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 2px solid #cdd5df;
            background: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .tag-default-box::after {
            content: '';
            width: 10px;
            height: 6px;
            border-left: 2px solid #fff;
            border-bottom: 2px solid #fff;
            transform: rotate(-45deg) scale(0.7);
            opacity: 0;
            transition: all 0.2s;
            margin-top: -1px;
        }

        .tag-default-check input:checked + .tag-default-box {
            border-color: var(--primary);
            background: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .tag-default-check input:checked + .tag-default-box::after {
            opacity: 1;
            transform: rotate(-45deg) scale(1);
        }

        .tag-default-text {
            line-height: 1.2;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }

            .main {
                margin-left: 0;
            }

            .mobile-header {
                display: flex;
                align-items: center;
                padding: 12px 16px;
                background: #fff;
                border-bottom: 1px solid var(--border);
                gap: 12px;
            }

            .back-btn {
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                background: none;
                border: none;
                cursor: pointer;
            }

            .header {
                padding: 16px;
                flex-direction: column;
                gap: 16px;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .content {
                padding: 16px;
            }

            .form-card {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .lang-section {
                padding: 16px;
            }
        }

        @media (min-width: 769px) {
            .mobile-header {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <div class="brand-icon"><img src="logo.png" alt="COFE+"></div>
                    <div class="brand-title">è¿è¥æ§åˆ¶å°</div>
                </div>
                <div class="brand-version">Prototype v0</div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">è¿è¥ç®¡ç†</div>
                    <a href="menu.html" class="nav-item">
                        <span class="nav-icon">ğŸ“Š</span>
                        <span>æ€»è§ˆ</span>
                    </a>
                    <a href="devices.html" class="nav-item">
                        <span class="nav-icon">âš™ï¸</span>
                        <span>è®¾å¤‡</span>
                    </a>
                    <a href="menu.html" class="nav-item active">
                        <span class="nav-icon">ğŸ“‹</span>
                        <span>èœå•</span>
                    </a>
                    <a href="materials.html" class="nav-item">
                        <span class="nav-icon">ğŸ“¦</span>
                        <span>ç‰©æ–™</span>
                    </a>
                    <a href="orders.html" class="nav-item">
                        <span class="nav-icon">ğŸ“</span>
                        <span>è®¢å•</span>
                    </a>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">åŸºç¡€ä¿¡æ¯ç®¡ç†</div>
                    <a href="customers.html" class="nav-item">
                        <span class="nav-icon">ğŸ¢</span>
                        <span>å®¢æˆ·ç®¡ç†</span>
                    </a>
                    <a href="locations.html" class="nav-item">
                        <span class="nav-icon">ğŸ“</span>
                        <span>ç‚¹ä½ç®¡ç†</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- ä¸»å†…å®¹ -->
        <main class="main">
            <!-- ç§»åŠ¨ç«¯å¤´éƒ¨ -->
            <div class="mobile-header">
                <button class="back-btn" onclick="goBack()">â†</button>
                <span style="font-weight: 700; font-size: 17px;">å•†å“è¯¦æƒ…</span>
            </div>

            <!-- é¡¶éƒ¨æ  -->
            <header class="header">
                <div class="header-left">
                    <span class="header-subtitle">Item detail</span>
                    <span class="header-title" id="productId">--</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-default" onclick="goBack()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="saveProduct()">ä¿å­˜</button>
                </div>
            </header>

            <!-- å†…å®¹åŒº -->
            <div class="content">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="form-card">
                    <h2 class="form-section-title">åŸºæœ¬ä¿¡æ¯</h2>

                    <!-- å•†å“å›¾ç‰‡ -->
                    <div class="form-group">
                        <label class="form-label">å•†å“å›¾ç‰‡</label>
                        <div id="productImagePreview" style="margin-bottom: 12px;">
                            <!-- åŠ¨æ€æ˜¾ç¤ºå›¾ç‰‡ -->
                        </div>
                        <input type="text" class="form-input" id="productImage" placeholder="è¯·è¾“å…¥å›¾ç‰‡URL">
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 6px;">æ”¯æŒ JPGã€PNG æ ¼å¼å›¾ç‰‡é“¾æ¥</div>
                    </div>
                    
                    <!-- å¤šè¯­è¨€åç§°å’Œæè¿° -->
                    <div id="multiLangInputs">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">æ‰€å±åˆ†ç±»</label>
                            <input type="text" class="form-input" id="categoryName" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å•†å“ä»·æ ¼ (CNY) <span class="required">*</span></label>
                            <input type="number" class="form-input" id="productPrice" step="0.1" min="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">å•†å“çŠ¶æ€</label>
                            <div class="switch-group" style="margin-top: 8px;">
                                <label class="switch">
                                    <input type="checkbox" id="onSaleSwitch" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="switch-label" id="onSaleLabel">åœ¨å”®</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">åŠŸèƒ½å¼€å…³</label>
                            <div class="switch-group" style="margin-top: 8px;">
                                <label class="switch">
                                    <input type="checkbox" id="featuredSwitch" checked>
                                    <span class="slider"></span>
                                </label>
                                <span class="switch-label">æ¨èå•†å“</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="option-toolbar">
                    <div class="option-toolbar-title">é…æ–¹é…ç½®</div>
                    <button class="btn btn-default" onclick="openTagConfigDrawer('beans')">æ ‡ç­¾é…ç½®</button>
                </div>

                <!-- é…æ–¹é…ç½® -->
                <div class="option-card">
                    <div class="option-title">BEAN / å’–å•¡è±†</div>
                    <div class="option-list" id="beanOptions">
                        <div class="option-item" data-value="ç²¾å“å’–å•¡-ç¿¡ç¿ ç‘°å¤">ç²¾å“å’–å•¡-ç¿¡ç¿ ç‘°å¤</div>
                        <div class="option-item selected" data-value="é‡‘å¥–é»‘å’–-æµ“é¦™æ„å¼">é‡‘å¥–é»‘å’–-æµ“é¦™æ„å¼</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">TEMPERATURE / æ¸©åº¦</div>
                    <div class="option-list" id="tempOptions">
                        <div class="option-item selected" data-value="çƒ­">çƒ­</div>
                        <div class="option-item" data-value="å†°">å†°</div>
                        <div class="option-item" data-value="å¸¸æ¸©">å¸¸æ¸©</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">PROFILE / æµ“åº¦</div>
                    <div class="option-list" id="profileOptions">
                        <div class="option-item selected" data-value="æ ‡å‡†">æ ‡å‡†</div>
                        <div class="option-item" data-value="åŠ 1ä»½æµ“ç¼©">åŠ 1ä»½æµ“ç¼©</div>
                        <div class="option-item" data-value="åŠ 2ä»½æµ“ç¼©">åŠ 2ä»½æµ“ç¼©</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">SYRUP / ç³–æµ†</div>
                    <div class="option-list" id="syrupOptions">
                        <div class="option-item selected" data-value="ç”˜è”—å†°ç³–ç³–æµ†">ç”˜è”—å†°ç³–ç³–æµ†</div>
                        <div class="option-item" data-value="é¦™è‰é£å‘³ç³–æµ†">é¦™è‰é£å‘³ç³–æµ†</div>
                        <div class="option-item" data-value="æ¦›æœé£å‘³ç³–æµ†">æ¦›æœé£å‘³ç³–æµ†</div>
                        <div class="option-item" data-value="æ— ç³–æµ†">æ— ç³–æµ†</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">SWEETNESS / ç”œåº¦</div>
                    <div class="option-list" id="sweetnessOptions">
                        <div class="option-item selected" data-value="æ— ç³–">æ— ç³–</div>
                        <div class="option-item" data-value="å°‘ç³–">å°‘ç³–</div>
                        <div class="option-item" data-value="æ ‡å‡†ç³–">æ ‡å‡†ç³–</div>
                        <div class="option-item" data-value="å¤šç³–">å¤šç³–</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">CUPSIZE / æ¯å‹</div>
                    <div class="option-list" id="cupsizeOptions">
                        <div class="option-item selected" data-value="355ml">355ml</div>
                        <div class="option-item" data-value="473ml">473ml</div>
                        <div class="option-item" data-value="592ml">592ml</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">LID / æ¯ç›–</div>
                    <div class="option-list" id="lidOptions">
                        <div class="option-item selected" data-value="å€¡å¯¼ç¯ä¿ ä¸ä½¿ç”¨æ¯ç›–">å€¡å¯¼ç¯ä¿ ä¸ä½¿ç”¨æ¯ç›–</div>
                        <div class="option-item" data-value="éœ€è¦æ¯ç›–">éœ€è¦æ¯ç›–</div>
                    </div>
                </div>

                <div class="option-card">
                    <div class="option-title">LATTE-ART / æ‹‰èŠ±</div>
                    <div class="option-list" id="latteArtOptions">
                        <div class="option-item selected" data-value="æ— ">æ— </div>
                        <div class="option-item" data-value="éšæœºæ‹‰èŠ±">éšæœºæ‹‰èŠ±</div>
                        <div class="option-item" data-value="ä¸Šä¼ å›¾ç‰‡">ä¸Šä¼ å›¾ç‰‡</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="tag-drawer-overlay" id="tagConfigDrawer">
        <div class="tag-drawer">
            <aside class="tag-drawer-side">
                <div class="tag-drawer-side-header">æ ‡ç­¾ç±»å‹</div>
                <div class="tag-tree" id="tagTree"></div>
            </aside>
            <section class="tag-drawer-main">
                <div class="tag-drawer-header">
                    <div class="tag-drawer-title" id="tagDrawerTitle">æ ‡ç­¾é…ç½®</div>
                    <button class="modal-close" onclick="closeTagConfigDrawer()">Ã—</button>
                </div>
                <div class="tag-drawer-body" id="tagDrawerEditor"></div>
                <div class="tag-drawer-footer">
                    <button class="btn btn-default" onclick="closeTagConfigDrawer()">å–æ¶ˆ</button>
                    <button class="btn btn-primary" onclick="saveTagConfigDrawer()">ä¿å­˜</button>
                </div>
            </section>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // è®¾å¤‡é…ç½®
        const deviceConfig = {
            'RCK111': { langs: ['zh', 'en'], langNames: { 'zh': 'ä¸­æ–‡', 'en': 'English' } },
            'RCK112': { langs: ['zh', 'en', 'jp'], langNames: { 'zh': 'ä¸­æ–‡', 'en': 'English', 'jp': 'æ—¥æœ¬èª' } },
            'RCK113': { langs: ['zh', 'en', 'ko', 'th'], langNames: { 'zh': 'ä¸­æ–‡', 'en': 'English', 'ko': 'í•œêµ­ì–´', 'th': 'à¹„à¸—à¸¢' } }
        };

        let productData = null;
        let categoryNames = {};
        let currentDevice = 'RCK111';
        let currentLang = 'zh';
        let drawerActiveSpecKey = 'beans';
        let drawerSelectedTagKey = '';
        const tagConfigs = [
            { specKey: 'beans', title: 'å’–å•¡è±†', listId: 'beanOptions', optionTitle: 'BEAN' },
            { specKey: 'temperature', title: 'æ¸©åº¦', listId: 'tempOptions', optionTitle: 'TEMPERATURE' },
            { specKey: 'strength', title: 'æµ“åº¦', listId: 'profileOptions', optionTitle: 'PROFILE' },
            { specKey: 'syrup', title: 'ç³–æµ†', listId: 'syrupOptions', optionTitle: 'SYRUP' },
            { specKey: 'sweetness', title: 'ç”œåº¦', listId: 'sweetnessOptions', optionTitle: 'SWEETNESS' },
            { specKey: 'cupsize', title: 'æ¯å‹', listId: 'cupsizeOptions', optionTitle: 'CUPSIZE' },
            { specKey: 'lid', title: 'æ¯ç›–', listId: 'lidOptions', optionTitle: 'LID' },
            { specKey: 'latteArt', title: 'æ‹‰èŠ±', listId: 'latteArtOptions', optionTitle: 'LATTE-ART' }
        ];

        function getDeviceLangs() {
            return deviceConfig[currentDevice]?.langs || ['zh', 'en'];
        }

        function getLangName(lang) {
            return deviceConfig[currentDevice]?.langNames[lang] || lang;
        }

        function getSpec(lang) {
            return (productData?.specs && productData.specs[lang]) || {};
        }

        function setSpec(lang, patch) {
            if (!productData.specs) productData.specs = {};
            const curr = productData.specs[lang] || {};
            productData.specs[lang] = { ...curr, ...patch };
        }

        function getDefaultOption(specKey) {
            return (productData.defaultOptions && productData.defaultOptions[specKey]) || '';
        }

        function setDefaultOption(specKey, value) {
            if (!productData.defaultOptions) productData.defaultOptions = {};
            if (value) productData.defaultOptions[specKey] = value;
            else delete productData.defaultOptions[specKey];
        }

        function getTagConfigBySpec(specKey) {
            return tagConfigs.find(cfg => cfg.specKey === specKey);
        }

        function getTagKeys(specKey) {
            const cfg = getTagConfigBySpec(specKey);
            if (!cfg) return [];
            const list = document.getElementById(cfg.listId);
            if (!list) return [];
            return Array.from(list.querySelectorAll('.option-item')).map(item => {
                if (!item.dataset.tagKey) item.dataset.tagKey = item.dataset.value;
                return item.dataset.tagKey;
            });
        }

        function ensureTagI18n(specKey) {
            if (!productData.tagI18n) productData.tagI18n = {};
            if (!productData.tagI18n[specKey]) productData.tagI18n[specKey] = {};

            const keys = getTagKeys(specKey);
            keys.forEach(key => {
                if (!productData.tagI18n[specKey][key]) productData.tagI18n[specKey][key] = {};
                if (!productData.tagI18n[specKey][key].zh) productData.tagI18n[specKey][key].zh = key;
            });
        }

        function getTagLabel(specKey, tagKey, lang) {
            ensureTagI18n(specKey);
            const i18n = productData.tagI18n?.[specKey]?.[tagKey] || {};
            return i18n[lang] || i18n.zh || tagKey;
        }

        function refreshOptionListLabels(specKey) {
            const cfg = getTagConfigBySpec(specKey);
            if (!cfg) return;
            const list = document.getElementById(cfg.listId);
            if (!list) return;

            list.querySelectorAll('.option-item').forEach(item => {
                if (!item.dataset.tagKey) item.dataset.tagKey = item.dataset.value;
                const key = item.dataset.tagKey;
                item.dataset.value = key;
                item.textContent = getTagLabel(specKey, key, currentLang);
            });
        }

        function resolveTagKey(specKey, rawValue) {
            if (!rawValue) return '';
            const keys = getTagKeys(specKey);
            if (keys.includes(rawValue)) return rawValue;
            const matched = keys.find(key => getTagLabel(specKey, key, currentLang) === rawValue);
            return matched || '';
        }

        function getCurrentSelectedTagKey(specKey) {
            const cfg = getTagConfigBySpec(specKey);
            if (!cfg) return '';
            const selected = document.querySelector(`#${cfg.listId} .option-item.selected`);
            if (!selected) return '';
            if (!selected.dataset.tagKey) selected.dataset.tagKey = selected.dataset.value;
            return selected.dataset.tagKey;
        }

        function syncSelectedOption(listId, value) {
            if (!value) return;
            const list = document.getElementById(listId);
            if (!list) return;
            const target = Array.from(list.querySelectorAll('.option-item')).find(item => item.dataset.value === value);
            if (!target) return;
            list.querySelectorAll('.option-item').forEach(item => item.classList.remove('selected'));
            target.classList.add('selected');
        }

        function updateOnSaleLabel() {
            const onSale = document.getElementById('onSaleSwitch').checked;
            document.getElementById('onSaleLabel').textContent = onSale ? 'åœ¨å”®' : 'ä¸åœ¨å”®';
        }

        function escAttr(v) {
            return String(v || '').replace(/&/g, '&amp;').replace(/"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function initPage() {
            // è§£æ URL å‚æ•°
            const params = new URLSearchParams(window.location.search);
            const productJson = params.get('product');
            const categoryJson = params.get('category');
            currentDevice = params.get('device') || 'RCK111';

            if (productJson) {
                try {
                    productData = JSON.parse(decodeURIComponent(productJson));
                } catch (e) {
                    console.error('è§£æå•†å“æ•°æ®å¤±è´¥', e);
                }
            }

            if (categoryJson) {
                try {
                    categoryNames = JSON.parse(decodeURIComponent(categoryJson));
                } catch (e) {
                    console.error('è§£æåˆ†ç±»æ•°æ®å¤±è´¥', e);
                }
            }

            if (productData) {
                document.getElementById('productId').textContent = 'ID: ' + productData.id;
                renderMultiLangInputs();
                fillFormData();
            }

            // å›¾ç‰‡è¾“å…¥ç›‘å¬
            document.getElementById('productImage').addEventListener('input', updateImagePreview);
            document.getElementById('onSaleSwitch').addEventListener('change', updateOnSaleLabel);

            // é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.option-list').forEach(list => {
                list.addEventListener('click', function(e) {
                    if (e.target.classList.contains('option-item')) {
                        this.querySelectorAll('.option-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        e.target.classList.add('selected');

                        const meta = tagConfigs.find(cfg => cfg.listId === this.id);
                        if (meta) {
                            if (!e.target.dataset.tagKey) e.target.dataset.tagKey = e.target.dataset.value;
                            setSpec(currentLang, { [meta.specKey]: e.target.dataset.tagKey });
                            if (drawerActiveSpecKey === meta.specKey) {
                                drawerSelectedTagKey = e.target.dataset.tagKey;
                            }
                        }
                    }
                });
            });
        }

        function renderMultiLangInputs() {
            const container = document.getElementById('multiLangInputs');
            const langs = getDeviceLangs();

            container.innerHTML = langs.map(lang => `
                <div class="lang-section">
                    <div class="lang-section-header">
                        <span class="lang-section-title">å•†å“ä¿¡æ¯</span>
                        <span class="lang-section-badge">${getLangName(lang)}</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å•†å“åç§° ${lang === langs[0] ? '<span class="required">*</span>' : ''}</label>
                        <input type="text" class="form-input product-name-${lang}" value="${productData.names?.[lang] || ''}" placeholder="è¯·è¾“å…¥${getLangName(lang)}åç§°">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">å•†å“æè¿°</label>
                        <textarea class="form-textarea product-desc-${lang}" placeholder="è¯·è¾“å…¥${getLangName(lang)}æè¿°" style="min-height: 60px;">${productData.descs?.[lang] || ''}</textarea>
                    </div>
                </div>
            `).join('');
        }

        function fillFormData() {
            // åˆ†ç±»åç§°ï¼ˆæ˜¾ç¤ºå½“å‰è¯­è¨€ï¼‰
            document.getElementById('categoryName').value = categoryNames[currentLang] || categoryNames['zh'] || categoryNames['en'] || '--';
            
            // å›¾ç‰‡
            document.getElementById('productImage').value = productData.image || '';
            updateImagePreview();
            
            // ä»·æ ¼
            document.getElementById('productPrice').value = productData.price || '';
            
            // æ¨èå¼€å…³
            document.getElementById('featuredSwitch').checked = productData.featured !== false;
            document.getElementById('onSaleSwitch').checked = productData.onSale !== false;
            updateOnSaleLabel();

            tagConfigs.forEach(meta => {
                ensureTagI18n(meta.specKey);
                refreshOptionListLabels(meta.specKey);
                const spec = getSpec(currentLang);
                const preferred = getDefaultOption(meta.specKey) || resolveTagKey(meta.specKey, spec[meta.specKey]) || resolveTagKey(meta.specKey, productData.options?.[meta.optionTitle]);
                if (preferred) {
                    syncSelectedOption(meta.listId, preferred);
                    setSpec(currentLang, { [meta.specKey]: preferred });
                }
            });
        }

        function updateImagePreview() {
            const previewContainer = document.getElementById('productImagePreview');
            const imageUrl = document.getElementById('productImage').value.trim();
            
            if (imageUrl) {
                previewContainer.innerHTML = `
                    <div style="width: 200px; height: 150px; border-radius: 8px; overflow: hidden; border: 1px solid var(--border);">
                        <img src="${imageUrl}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.parentElement.innerHTML='<div style=\\'display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:13px;\\'>å›¾ç‰‡åŠ è½½å¤±è´¥</div>'">
                    </div>
                `;
            } else {
                previewContainer.innerHTML = `
                    <div style="width: 200px; height: 150px; border-radius: 8px; background: #f5f7fa; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); font-size: 13px;">
                        <span style="font-size: 36px; margin-bottom: 8px;">â˜•</span>
                        <span>æš‚æ— å›¾ç‰‡</span>
                    </div>
                `;
            }
        }

        function getSelectedOptions() {
            const options = {};
            const titles = ['BEAN', 'TEMPERATURE', 'PROFILE', 'SYRUP', 'SWEETNESS', 'CUPSIZE', 'LID', 'LATTE-ART'];
            const ids = ['beanOptions', 'tempOptions', 'profileOptions', 'syrupOptions', 'sweetnessOptions', 'cupsizeOptions', 'lidOptions', 'latteArtOptions'];
            
            ids.forEach((id, index) => {
                const selected = document.querySelector(`#${id} .option-item.selected`);
                options[titles[index]] = selected ? selected.dataset.value : '';
            });
            
            return options;
        }

        function renderTagTree() {
            const tree = document.getElementById('tagTree');
            tree.innerHTML = tagConfigs.map(cfg => `
                <button class="tag-tree-item ${cfg.specKey === drawerActiveSpecKey ? 'active' : ''}" onclick="switchDrawerTag('${cfg.specKey}')">
                    ${cfg.title}
                </button>
            `).join('');
        }

        function renderDrawerEditor() {
            const cfg = getTagConfigBySpec(drawerActiveSpecKey);
            if (!cfg) return;
            const langs = getDeviceLangs();
            const container = document.getElementById('tagDrawerEditor');
            document.getElementById('tagDrawerTitle').textContent = `${cfg.title}æ ‡ç­¾é…ç½®`;
            ensureTagI18n(cfg.specKey);
            refreshOptionListLabels(cfg.specKey);

            const tagKeys = getTagKeys(cfg.specKey);
            if (!drawerSelectedTagKey || !tagKeys.includes(drawerSelectedTagKey)) {
                drawerSelectedTagKey = getCurrentSelectedTagKey(cfg.specKey) || tagKeys[0] || '';
            }
            const currentDefault = getDefaultOption(cfg.specKey);

            let html = `<div class="existing-tag-helper">ç°æœ‰æ ‡ç­¾ï¼ˆç‚¹å‡»é€‰æ‹©ä¸€ä¸ªè¿›è¡Œç¼–è¾‘ï¼‰</div>`;
            html += `<div class="existing-tags">`;
            html += tagKeys.map(tagKey => `
                <button class="existing-tag-item ${tagKey === drawerSelectedTagKey ? 'active' : ''}" onclick="selectDrawerTag('${tagKey}')">
                    ${getTagLabel(cfg.specKey, tagKey, currentLang)}
                </button>
            `).join('');
            html += `</div>`;

            html += langs.map(lang => `
                <div class="lang-section">
                    <div class="lang-section-header">
                        <span class="lang-section-title">${cfg.title}æ ‡ç­¾</span>
                        <span class="lang-section-badge">${getLangName(lang)}</span>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">æ ‡ç­¾å†…å®¹</label>
                        <input type="text" class="form-input drawer-tag-lang-${lang}" value="${escAttr(getTagLabel(cfg.specKey, drawerSelectedTagKey, lang))}" placeholder="è¯·è¾“å…¥${getLangName(lang)}${cfg.title}æ ‡ç­¾">
                    </div>
                </div>
            `).join('');

            html += `
                <div class="tag-default-wrap">
                    <label class="tag-default-check">
                        <input type="checkbox" id="drawerTagDefaultSingle" ${(currentDefault && currentDefault === drawerSelectedTagKey) ? 'checked' : ''}>
                        <span class="tag-default-box"></span>
                        <span class="tag-default-text">å®¢æˆ·è´­ä¹°æ—¶é»˜è®¤é€‰ä¸­</span>
                    </label>
                </div>
            `;
            container.innerHTML = html;
        }

        function persistDrawerCurrentTag() {
            const cfg = getTagConfigBySpec(drawerActiveSpecKey);
            if (!cfg || !drawerSelectedTagKey) return;
            const langs = getDeviceLangs();
            langs.forEach(lang => {
                const el = document.querySelector('.drawer-tag-lang-' + lang);
                const val = el ? el.value.trim() : '';
                ensureTagI18n(cfg.specKey);
                if (!productData.tagI18n[cfg.specKey][drawerSelectedTagKey]) productData.tagI18n[cfg.specKey][drawerSelectedTagKey] = {};
                if (val) productData.tagI18n[cfg.specKey][drawerSelectedTagKey][lang] = val;
                else delete productData.tagI18n[cfg.specKey][drawerSelectedTagKey][lang];
            });

            const shouldDefault = !!(document.getElementById('drawerTagDefaultSingle') && document.getElementById('drawerTagDefaultSingle').checked);
            if (shouldDefault) setDefaultOption(cfg.specKey, drawerSelectedTagKey);
            if (!shouldDefault) setDefaultOption(cfg.specKey, '');

            refreshOptionListLabels(cfg.specKey);
            const selectedKey = getCurrentSelectedTagKey(cfg.specKey);
            const effectiveKey = getDefaultOption(cfg.specKey) || selectedKey || drawerSelectedTagKey;
            if (effectiveKey) {
                syncSelectedOption(cfg.listId, effectiveKey);
                setSpec(currentLang, { [cfg.specKey]: effectiveKey });
            }
        }

        function selectDrawerTag(tagKey) {
            persistDrawerCurrentTag();
            drawerSelectedTagKey = tagKey;
            renderDrawerEditor();
        }

        function switchDrawerTag(specKey) {
            persistDrawerCurrentTag();
            drawerActiveSpecKey = specKey;
            drawerSelectedTagKey = getCurrentSelectedTagKey(specKey) || getTagKeys(specKey)[0] || '';
            renderTagTree();
            renderDrawerEditor();
        }

        function openTagConfigDrawer(initialSpecKey = 'beans') {
            drawerActiveSpecKey = initialSpecKey;
            drawerSelectedTagKey = getCurrentSelectedTagKey(initialSpecKey) || getTagKeys(initialSpecKey)[0] || '';
            renderTagTree();
            renderDrawerEditor();
            document.getElementById('tagConfigDrawer').classList.add('active');
        }

        function closeTagConfigDrawer() {
            document.getElementById('tagConfigDrawer').classList.remove('active');
        }

        function saveTagConfigDrawer() {
            persistDrawerCurrentTag();
            closeTagConfigDrawer();
            showToast('æ ‡ç­¾é…ç½®å·²æ›´æ–°');
        }

        function saveProduct() {
            if (!productData) return;

            const langs = getDeviceLangs();
            const firstLang = langs[0];

            // éªŒè¯ä¸»è¯­è¨€åç§°
            const firstName = document.querySelector('.product-name-' + firstLang).value.trim();
            if (!firstName) {
                showToast(`è¯·è¾“å…¥${getLangName(firstLang)}å•†å“åç§°`, 'error');
                return;
            }

            const price = parseFloat(document.getElementById('productPrice').value);
            if (!price || price <= 0) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼', 'error');
                return;
            }

            // æ”¶é›†å¤šè¯­è¨€æ•°æ®
            const names = {};
            const descs = {};
            
            langs.forEach(lang => {
                const nameEl = document.querySelector('.product-name-' + lang);
                const descEl = document.querySelector('.product-desc-' + lang);
                
                if (nameEl && nameEl.value.trim()) {
                    names[lang] = nameEl.value.trim();
                }
                if (descEl && descEl.value.trim()) {
                    descs[lang] = descEl.value.trim();
                }
            });

            // å›¾ç‰‡
            const image = document.getElementById('productImage').value.trim();

            // æ›´æ–°å•†å“æ•°æ®
            const updatedProduct = {
                ...productData,
                names: names,
                descs: descs,
                image: image || null,
                price: price,
                featured: document.getElementById('featuredSwitch').checked,
                onSale: document.getElementById('onSaleSwitch').checked,
                specs: productData.specs || {},
                defaultOptions: productData.defaultOptions || {},
                options: getSelectedOptions()
            };

            const edits = JSON.parse(localStorage.getItem('menuProductEdits') || '{}');
            edits[updatedProduct.id] = updatedProduct;
            localStorage.setItem('menuProductEdits', JSON.stringify(edits));

            showToast('å•†å“é…ç½®å·²ä¿å­˜');

            // è¿”å›èœå•é¡µ
            setTimeout(() => {
                goBack();
            }, 800);
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        function goBack() {
            window.location.href = 'menu.html';
        }

        function goTo(url) {
            window.location.href = url;
        }

        window.onload = initPage;
    </script>
</body>
</html>
